<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.blogforum.manager.dao.mapper.AdminUserMapper">

    <sql id="AdminUserColumns">
        a.id id,
        a.username username,
        a.create_date createDate,
        r.id r_id,
        r.name name
    </sql>
    <resultMap id="AdminUserResult" type="com.blogforum.manager.pojo.entity.AdminUser">
        <id property="id" column="id" />
        <result property="username" column="username" />
        <result property="createDate" column="createDate" />
        	<association property="role" javaType="com.blogforum.manager.pojo.entity.Role">
		        <id property="id" column="r_id" />
		        <result property="name" column="name" />
	        </association>
    </resultMap>
    
    <!-- 添加用户 -->
	<insert id="insert" parameterType="com.blogforum.manager.pojo.entity.AdminUser">
		insert into admin_user(username,password,salt,role,create_date) values (#{username},#{password},#{salt},#{roleId},#{createDate})
	</insert>
	
	<!-- 根据用户名查询 -->
	<select id="getByUserName" resultType="com.blogforum.manager.pojo.entity.AdminUser">
	    select id,salt
	    from admin_user
	    where
	    username = #{username}
	</select>
	
	<!-- 通过用户名密码查询用户  -->
	<select id="getByUserPwd" parameterType="com.blogforum.manager.pojo.entity.AdminUser" resultMap="AdminUserResult">
	    select 
	    <include refid="AdminUserColumns"/>
	    from admin_user a
	    LEFT JOIN role r
	    on
	    a.role = r.id
	    where
	    a.username = #{username} and a.password = #{password}
	    
	</select>
	
	<!-- 通过ID查询用户 -->
	<select id="getByID" resultMap="AdminUserResult">
	    select 
	    <include refid="AdminUserColumns"/>
	    from admin_user a
	    LEFT JOIN role r
	    on
	    a.role_id = r.id
	    where
	    a.id=#{adminUser_id}
	</select>
	
	
	
	

</mapper>